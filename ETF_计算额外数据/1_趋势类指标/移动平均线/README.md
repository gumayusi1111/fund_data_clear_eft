# SMA计算器 - 中短线专版

## 概述

简单移动平均线(SMA)计算器，专门为中短线交易设计，提供核心技术分析指标。

### 🎯 核心指标
- **MA5**: 5日移动平均线 (超短期趋势)
- **MA10**: 10日移动平均线 (短期趋势)  
- **MA20**: 20日移动平均线 (月线趋势)
- **MA60**: 60日移动平均线 (季线趋势)

### 🆕 差值指标
- **SMA差值5-20**: MA5 - MA20 (核心趋势强度指标)
- **SMA差值5-10**: MA5 - MA10 (短期动量指标)
- **SMA差值5-20(%)**: 相对差值百分比

## 特色功能

### ✨ 专注中短线
- 移除长线指标(MA120, MA250)，专注实用的中短线指标
- 针对中短线交易优化的信号分析
- 多空排列智能判断

### 📊 差值分析
- 计算短期与长期SMA的差值
- 提供绝对差值和相对差值百分比
- 趋势方向图标显示(📈📉➡️)

### 🔄 多种模式
- 单个ETF计算模式
- 基于筛选结果的批量计算模式
- 快速分析模式（不保存文件）

## 系统架构

```
sma_calculator/
├── __init__.py          # 模块初始化
├── config.py            # 配置管理
├── data_reader.py       # 数据读取器
├── sma_engine.py        # SMA计算引擎
├── signal_analyzer.py   # 信号分析器
├── result_processor.py  # 结果处理器
├── file_manager.py      # 文件管理器
└── controller.py        # 主控制器
```

## 安装要求

```bash
pip install pandas numpy
```

## 使用方法

### 1. 单个ETF计算

```bash
# 计算单个ETF的SMA指标
python sma_main.py --etf 510050.SH

# 指定复权类型
python sma_main.py --etf 510050.SH --adj_type 前复权

# 自定义周期
python sma_main.py --etf 510050.SH --periods 5 10 20
```

### 2. 快速分析

```bash
# 快速分析（不保存文件）
python sma_main.py --quick 510050.SH
```

### 3. 批量处理筛选结果

```bash
# 处理所有门槛的筛选结果
python sma_main.py --screening

# 处理指定门槛
python sma_main.py --screening --threshold 3000万门槛
python sma_main.py --screening --threshold 5000万门槛
```

### 4. 系统管理

```bash
# 查看系统状态
python sma_main.py --status

# 列出可用ETF代码
python sma_main.py --list

# 详细输出模式
python sma_main.py --etf 510050.SH --verbose
```

## 输出格式

### 单行CSV格式
每个ETF生成一个单独的CSV文件，包含最新的SMA数据：

```csv
ETF代码,复权类型,最新日期,最新价格,涨跌幅(%),MA5,MA10,MA20,MA60,SMA差值5-20,SMA差值5-10,SMA差值5-20(%),多空排列
510050,前复权,2025-01-24,1.972,0.051,1.968,1.964,1.947,1.901,0.021228,0.004000,1.09,强势多头排列
```

### 控制台输出示例
```
📊 510050.SH SMA分析结果:
   💰 价格: 1.972 (+0.051%) [2025-01-24]
   🎯 SMA: MA5:1.968 MA10:1.964 MA20:1.947 MA60:1.901 
   📊 SMA差值: 5-20=+0.021228 (+1.09%) 📈
              5-10=+0.004000 (短期动量)
   🔄 排列: 强势多头排列
   🎯 信号: 买入 (强度:3, 置信度:80%)
```

## 多空排列判断

### 强势多头排列
- MA5 > MA10 > MA20 > MA60
- 短期均线全面上移，趋势强劲

### 中期多头排列  
- MA5 > MA10 > MA20，但MA60关系不确定
- 中短期看涨，长期需观察

### 短期多头排列
- MA5 > MA10，其他关系混合
- 短期有上涨动力

### 空头排列
- 对应的反向排列
- 表示下跌趋势

### 震荡排列
- 均线交织，无明确方向
- 建议观望等待明确信号

## 信号强度评分

### 评分体系(-5到+5)
- **+4以上**: 强烈买入信号
- **+2到+3**: 买入信号
- **+1**: 弱势买入
- **0**: 中性观望
- **-1**: 弱势卖出
- **-2到-3**: 卖出信号
- **-4以下**: 强烈卖出信号

### 信号组成
1. **多空排列权重**: ±3分
2. **SMA差值信号**: ±2分
3. **短期动量**: ±0.5分
4. **趋势一致性**: +1分

## 文件输出结构

```
data/
├── 3000万门槛/
│   ├── 159001.csv
│   ├── 159003.csv
│   └── ...
└── 5000万门槛/
    ├── 159001.csv
    ├── 159003.csv
    └── ...
```

## 技术特点

### 🔬 科学严谨
- 使用标准SMA公式: SMA = Σ(Price_i) / n
- 高精度float64计算
- 独立算法验证计算结果

### ⚡ 高性能
- pandas向量化计算
- 智能数据限制(70行缓冲)
- 批量处理优化

### 🛡️ 数据安全
- 只读模式，不修改原始数据
- 完整的错误处理和数据验证
- 智能路径检测

### 📊 智能分析
- 自动多空排列判断
- 综合交易信号评分
- 趋势一致性分析

## 错误处理

### 常见问题解决

1. **数据路径不存在**
   ```
   ❌ 数据路径不存在: /path/to/ETF日更/0_ETF日K(前复权)
   ```
   解决：检查项目根目录路径，确保ETF日更数据存在

2. **ETF代码无效**
   ```
   ❌ ETF代码无效: 510050 (文件不存在)
   ```
   解决：使用完整ETF代码(如510050.SH)或检查数据文件

3. **数据不足**
   ```
   ❌ 510050.SH: 有效数据(30行)不足以计算MA60
   ```
   解决：确保ETF数据至少有60行历史记录

## 性能优化

### 内存优化
- 只加载必要的70行数据
- 及时释放大型DataFrame
- 使用生成器处理批量数据

### 计算优化
- pandas内置rolling.mean()函数
- 向量化差值计算
- 批量信号分析

## 扩展说明

### 添加新指标
1. 在`sma_engine.py`中添加计算逻辑
2. 在`result_processor.py`中添加输出字段
3. 在`signal_analyzer.py`中集成信号分析

### 修改周期
```python
# 自定义周期配置
controller = SMAController(
    sma_periods=[3, 5, 10, 15, 30]  # 自定义周期
)
```

### 输出格式扩展
- JSON格式输出支持
- 图表生成接口
- 数据库存储选项

## 注意事项

1. **数据依赖**: 需要完整的ETF日更数据
2. **路径配置**: 确保项目目录结构正确
3. **计算精度**: 使用前复权数据获得最佳分析效果
4. **信号延迟**: SMA为滞后指标，信号有延迟性

## 版本信息

- **版本**: SMA Calculator v1.0 (中短线专版)
- **创建时间**: 2025年1月
- **适用范围**: 中短线ETF技术分析
- **维护状态**: 活跃开发中

## 联系支持

如有问题或建议，请在项目中创建issue或联系开发团队。 